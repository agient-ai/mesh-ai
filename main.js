/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var dt=Object.create;var ve=Object.defineProperty;var ht=Object.getOwnPropertyDescriptor;var gt=Object.getOwnPropertyNames;var mt=Object.getPrototypeOf,ft=Object.prototype.hasOwnProperty;var vt=(p,t)=>()=>(t||p((t={exports:{}}).exports,t),t.exports),yt=(p,t)=>{for(var e in t)ve(p,e,{get:t[e],enumerable:!0})},ze=(p,t,e,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of gt(t))!ft.call(p,r)&&r!==e&&ve(p,r,{get:()=>t[r],enumerable:!(n=ht(t,r))||n.enumerable});return p};var wt=(p,t,e)=>(e=p!=null?dt(mt(p)):{},ze(t||!p||!p.__esModule?ve(e,"default",{value:p,enumerable:!0}):e,p)),Pt=p=>ze(ve({},"__esModule",{value:!0}),p);var We=vt((je,ye)=>{((p,t)=>{typeof define=="function"&&define.amd?define([],t):typeof ye=="object"&&ye.exports?ye.exports=t():p.fuzzysort=t()})(je,p=>{"use strict";var t=(l,s)=>{if(!l||!s)return C;var c=O(l);re(s)||(s=_(s));var g=c.bitflags;return(g&s._bitflags)!==g?C:z(c,s)},e=(l,s,c)=>{if(!l)return c!=null&&c.all?V(s,c):$e;var g=O(l),m=g.bitflags,h=g.containsSpace,u=I((c==null?void 0:c.threshold)||0),v=(c==null?void 0:c.limit)||ke,f=0,w=0,P=s.length;function B(ne){f<v?(me.add(ne),++f):(++w,ne._score>me.peek()._score&&me.replaceTop(ne))}if(c!=null&&c.key)for(var N=c.key,A=0;A<P;++A){var R=s[A],S=ge(R,N);if(S&&(re(S)||(S=_(S)),(m&S._bitflags)===m)){var T=z(g,S);T!==C&&(T._score<u||(T.obj=R,B(T)))}}else if(c!=null&&c.keys){var X=c.keys,G=X.length;e:for(var A=0;A<P;++A){var R=s[A];{for(var k=0,b=0;b<G;++b){var N=X[b],S=ge(R,N);if(!S){Ne[b]=pe;continue}re(S)||(S=_(S)),Ne[b]=S,k|=S._bitflags}if((m&k)!==m)continue}if(h)for(let x=0;x<g.spaceSearches.length;x++)j[x]=K;for(var b=0;b<G;++b){if(S=Ne[b],S===pe){oe[b]=pe;continue}if(oe[b]=z(g,S,!1,h),oe[b]===C){oe[b]=pe;continue}if(h)for(let M=0;M<g.spaceSearches.length;M++){if(te[M]>-1e3&&j[M]>K){var H=(j[M]+te[M])/4;H>j[M]&&(j[M]=H)}te[M]>j[M]&&(j[M]=te[M])}}if(h){for(let x=0;x<g.spaceSearches.length;x++)if(j[x]===K)continue e}else{var y=!1;for(let x=0;x<G;x++)if(oe[x]._score!==K){y=!0;break}if(!y)continue}var q=new a(G);for(let x=0;x<G;x++)q[x]=oe[x];if(h){var L=0;for(let x=0;x<g.spaceSearches.length;x++)L+=j[x]}else{var L=K;for(let M=0;M<G;M++){var T=q[M];if(T._score>-1e3&&L>K){var H=(L+T._score)/4;H>L&&(L=H)}T._score>L&&(L=T._score)}}if(q.obj=R,q._score=L,c!=null&&c.scoreFn){if(L=c.scoreFn(q),!L)continue;L=I(L),q._score=L}L<u||B(q)}}else for(var A=0;A<P;++A){var S=s[A];if(S&&(re(S)||(S=_(S)),(m&S._bitflags)===m)){var T=z(g,S);T!==C&&(T._score<u||B(T))}}if(f===0)return $e;for(var Z=new Array(f),A=f-1;A>=0;--A)Z[A]=me.poll();return Z.total=f+w,Z},n=(l,s="<b>",c="</b>")=>{for(var g=typeof s=="function"?s:void 0,m=l.target,h=m.length,u=l.indexes,v="",f=0,w=0,P=!1,B=[],N=0;N<h;++N){var A=m[N];if(u[w]===N){if(++w,P||(P=!0,g?(B.push(v),v=""):v+=s),w===u.length){g?(v+=A,B.push(g(v,f++)),v="",B.push(m.substr(N+1))):v+=A+c+m.substr(N+1);break}}else P&&(P=!1,g?(B.push(g(v,f++)),v=""):v+=c);v+=A}return g?B:v},r=l=>{typeof l=="number"?l=""+l:typeof l!="string"&&(l="");var s=ce(l);return d(l,{_targetLower:s._lower,_targetLowerCodes:s.lowerCodes,_bitflags:s.bitflags})},i=()=>{Q.clear(),ee.clear()};class o{get indexes(){return this._indexes.slice(0,this._indexes.len).sort((s,c)=>s-c)}set indexes(s){return this._indexes=s}highlight(s,c){return n(this,s,c)}get score(){return E(this._score)}set score(s){this._score=I(s)}}class a extends Array{get score(){return E(this._score)}set score(s){this._score=I(s)}}var d=(l,s)=>{var g,m,h,u,v,f,w;let c=new o;return c.target=l,c.obj=(g=s.obj)!=null?g:C,c._score=(m=s._score)!=null?m:K,c._indexes=(h=s._indexes)!=null?h:[],c._targetLower=(u=s._targetLower)!=null?u:"",c._targetLowerCodes=(v=s._targetLowerCodes)!=null?v:C,c._nextBeginningIndexes=(f=s._nextBeginningIndexes)!=null?f:C,c._bitflags=(w=s._bitflags)!=null?w:0,c},E=l=>l===K?0:l>1?l:Math.E**(((-l+1)**.04307-1)*-2),I=l=>l===0?K:l>1?l:1-Math.pow(Math.log(l)/-2+1,1/.04307),U=l=>{typeof l=="number"?l=""+l:typeof l!="string"&&(l=""),l=l.trim();var s=ce(l),c=[];if(s.containsSpace){var g=l.split(/\s+/);g=[...new Set(g)];for(var m=0;m<g.length;m++)if(g[m]!==""){var h=ce(g[m]);c.push({lowerCodes:h.lowerCodes,_lower:g[m].toLowerCase(),containsSpace:!1})}}return{lowerCodes:s.lowerCodes,_lower:s._lower,containsSpace:s.containsSpace,bitflags:s.bitflags,spaceSearches:c}},_=l=>{if(l.length>999)return r(l);var s=Q.get(l);return s!==void 0||(s=r(l),Q.set(l,s)),s},O=l=>{if(l.length>999)return U(l);var s=ee.get(l);return s!==void 0||(s=U(l),ee.set(l,s)),s},V=(l,s)=>{var c=[];c.total=l.length;var g=(s==null?void 0:s.limit)||ke;if(s!=null&&s.key)for(var m=0;m<l.length;m++){var h=l[m],u=ge(h,s.key);if(u!=C){re(u)||(u=_(u));var v=d(u.target,{_score:u._score,obj:h});if(c.push(v),c.length>=g)return c}}else if(s!=null&&s.keys)for(var m=0;m<l.length;m++){for(var h=l[m],f=new a(s.keys.length),w=s.keys.length-1;w>=0;--w){var u=ge(h,s.keys[w]);if(!u){f[w]=pe;continue}re(u)||(u=_(u)),u._score=K,u._indexes.len=0,f[w]=u}if(f.obj=h,f._score=K,c.push(f),c.length>=g)return c}else for(var m=0;m<l.length;m++){var u=l[m];if(u!=C&&(re(u)||(u=_(u)),u._score=K,u._indexes.len=0,c.push(u),c.length>=g))return c}return c},z=(l,s,c=!1,g=!1)=>{if(c===!1&&l.containsSpace)return Ge(l,s,g);for(var m=l._lower,h=l.lowerCodes,u=h[0],v=s._targetLowerCodes,f=h.length,w=v.length,A=0,P=0,B=0;;){var N=u===v[P];if(N){if(J[B++]=P,++A,A===f)break;u=h[A]}if(++P,P>=w)return C}var A=0,R=!1,S=0,T=s._nextBeginningIndexes;T===C&&(T=s._nextBeginningIndexes=Ve(s.target)),P=J[0]===0?0:T[J[0]-1];var X=0;if(P!==w)for(;;)if(P>=w){if(A<=0||(++X,X>200))break;--A;var G=de[--S];P=T[G]}else{var N=h[A]===v[P];if(N){if(de[S++]=P,++A,A===f){R=!0;break}++P}else P=T[P]}var k=f<=1?-1:s._targetLower.indexOf(m,J[0]),b=!!~k,H=b?k===0||s._nextBeginningIndexes[k-1]===k:!1;if(b&&!H){for(var y=0;y<T.length;y=T[y])if(!(y<=k)){for(var q=0;q<f&&h[q]===s._targetLowerCodes[y+q];q++);if(q===f){k=y,H=!0;break}}}var L=x=>{for(var M=0,Je=0,W=1;W<f;++W)x[W]-x[W-1]!==1&&(M-=x[W],++Je);var ut=x[f-1]-x[0]-(f-1);if(M-=(12+ut)*Je,x[0]!==0&&(M-=x[0]*x[0]*.2),!R)M*=1e3;else{for(var Oe=1,W=T[0];W<w;W=T[W])++Oe;Oe>24&&(M*=(Oe-24)*10)}return M-=(w-f)/2,b&&(M/=1+f*f*1),H&&(M/=1+f*f*1),M-=(w-f)/2,M};if(R)if(H){for(var y=0;y<f;++y)J[y]=k+y;var Z=J,ne=L(J)}else var Z=de,ne=L(de);else{if(b)for(var y=0;y<f;++y)J[y]=k+y;var Z=J,ne=L(Z)}s._score=ne;for(var y=0;y<f;++y)s._indexes[y]=Z[y];s._indexes.len=f;let fe=new o;return fe.target=s.target,fe._score=s._score,fe._indexes=s._indexes,fe},Ge=(l,s,c)=>{for(var g=new Set,m=0,h=C,u=0,v=l.spaceSearches,f=v.length,w=0,P=()=>{for(let H=w-1;H>=0;H--)s._nextBeginningIndexes[he[H*2+0]]=he[H*2+1]},B=!1,b=0;b<f;++b){te[b]=K;var N=v[b];if(h=z(N,s),c){if(h===C)continue;B=!0}else if(h===C)return P(),C;var A=b===f-1;if(!A){var R=h._indexes,S=!0;for(let y=0;y<R.len-1;y++)if(R[y+1]-R[y]!==1){S=!1;break}if(S){var T=R[R.len-1]+1,X=s._nextBeginningIndexes[T-1];for(let y=T-1;y>=0&&X===s._nextBeginningIndexes[y];y--)s._nextBeginningIndexes[y]=T,he[w*2+0]=y,he[w*2+1]=X,w++}}m+=h._score/f,te[b]=h._score/f,h._indexes[0]<u&&(m-=(u-h._indexes[0])*2),u=h._indexes[0];for(var G=0;G<h._indexes.len;++G)g.add(h._indexes[G])}if(c&&!B)return C;P();var k=z(l,s,!0);if(k!==C&&k._score>m){if(c)for(var b=0;b<f;++b)te[b]=k._score/f;return k}c&&(h=s),h._score=m;var b=0;for(let H of g)h._indexes[b++]=H;return h._indexes.len=b,h},ce=l=>{for(var s=l.length,c=l.toLowerCase(),g=[],m=0,h=!1,u=0;u<s;++u){var v=g[u]=c.charCodeAt(u);if(v===32){h=!0;continue}var f=v>=97&&v<=122?v-97:v>=48&&v<=57?26:v<=127?30:31;m|=1<<f}return{lowerCodes:g,bitflags:m,containsSpace:h,_lower:c}},Ye=l=>{for(var s=l.length,c=[],g=0,m=!1,h=!1,u=0;u<s;++u){var v=l.charCodeAt(u),f=v>=65&&v<=90,w=f||v>=97&&v<=122||v>=48&&v<=57,P=f&&!m||!h||!w;m=f,h=w,P&&(c[g++]=u)}return c},Ve=l=>{for(var s=l.length,c=Ye(l),g=[],m=c[0],h=0,u=0;u<s;++u)m>u?g[u]=m:(m=c[++h],g[u]=m===void 0?s:m);return g},Q=new Map,ee=new Map,J=[],de=[],he=[],j=[],te=[],Ne=[],oe=[],ge=(l,s)=>{var c=l[s];if(c!==void 0)return c;if(typeof s=="function")return s(l);var g=s;Array.isArray(s)||(g=s.split("."));for(var m=g.length,h=-1;l&&++h<m;)l=l[g[h]];return l},re=l=>typeof l=="object"&&typeof l._bitflags=="number",ke=1/0,K=-ke,$e=[];$e.total=0;var C=null,pe=r(""),pt=l=>{var s=[],c=0,g={},m=h=>{for(var u=0,v=s[u],f=1;f<c;){var w=f+1;u=f,w<c&&s[w]._score<s[f]._score&&(u=w),s[u-1>>1]=s[u],f=1+(u<<1)}for(var P=u-1>>1;u>0&&v._score<s[P]._score;P=(u=P)-1>>1)s[u]=s[P];s[u]=v};return g.add=h=>{var u=c;s[c++]=h;for(var v=u-1>>1;u>0&&h._score<s[v]._score;v=(u=v)-1>>1)s[u]=s[v];s[u]=h},g.poll=h=>{if(c!==0){var u=s[0];return s[0]=s[--c],m(),u}},g.peek=h=>{if(c!==0)return s[0]},g.replaceTop=h=>{s[0]=h,m()},g},me=pt();return{single:t,go:e,prepare:r,cleanup:i}})});var At={};yt(At,{default:()=>He});module.exports=Pt(At);var F=require("obsidian");var ie=require("obsidian");var we=require("obsidian"),Xe=wt(We());async function Re(p,t){console.log(`Searching for pattern: ${t}`);async function e(r){let i=p.app.vault.getAbstractFileByPath(r);if(i instanceof we.TFolder){console.log(`Searching in folder: ${r}`);let o=i.children.filter(d=>d instanceof we.TFile);console.log(`Files in folder: ${o.map(d=>d.name).join(", ")}`);let a=o.find(d=>d.name===t);if(a||(a=o.find(d=>d.name===`${t}.md`)),a||(a=o.find(d=>d.name.toLowerCase()===t.toLowerCase())),a)return console.log(`Pattern found: ${a.path}`),a}else console.log(`Folder not found: ${r}`);return null}let n=await e(p.settings.customPatternsFolder);if(n||(n=await e(p.settings.fabricPatternsFolder)),n)return await p.app.vault.read(n);throw console.log(`Pattern '${t}' not found in custom or fabric patterns folders`),new Error(`Pattern '${t}' not found in custom or fabric patterns folders`)}async function bt(p,t,e=10){let n=[...await p.loadCustomPatterns(),...await p.loadFabricPatterns()];return Xe.go(t,n,{limit:e})}async function Ze(p,t,e,n){if(e.empty(),t.length===0){e.style.display="none";return}let r=await bt(p,t);r.length>0?(r.forEach(i=>{e.createEl("div",{text:i.target,cls:"pattern-result"}).addEventListener("click",()=>n(i.target))}),e.style.display="block"):e.style.display="none"}function Qe(p,t,e,n,r){t.includes(p)||(t.push(p),e()),n(),r()}function Be(p,t,e){p.empty(),t.forEach(n=>{let r=Et(n,i=>{let o=t.filter(a=>a!==i);e(o),Be(p,o,e)});p.appendChild(r)})}function Et(p,t){let e=document.createElement("div");return e.textContent=p,e.className="selected-pattern",e.createEl("span",{text:"\xD7",cls:"remove-pattern"}).addEventListener("click",()=>t(p)),e}var Pe=require("obsidian");async function et(p){let t=p.workspace.getActiveFile();if(t instanceof Pe.TFile)return await p.vault.read(t);throw new Error("No active note found")}async function De(p,t,e){let n=p.settings.meshOutputFolder;if(!n)throw new Error("Mesh output folder not set");let r=e.value.trim()||"Mesh Note",i=`${r}.md`,o=1;for(;await p.app.vault.adapter.exists(`${n}/${i}`);)i=`${r} (${o}).md`,o++;let a=`${n}/${i}`;await p.app.vault.create(a,t),new Pe.Notice(`File created: ${i}`);let d=p.app.vault.getAbstractFileByPath(a);await this.app.workspace.getLeaf(!1).openFile(d)}var ue=class{constructor(t){this.containerEl=t}static createSelect(t,e,n){let r=(t instanceof HTMLElement,t).createEl("select",{cls:e});return n.forEach(i=>{r.createEl("option",{value:i,text:i})}),r}createUI(t,e){this.containerEl.empty(),this.containerEl.addClass("mesh-ai-container");let n=this.containerEl.createEl("h2",{text:"Mesh AI"}),r=this.createProviderSelect(t),i=this.createPromptInput();this.createSubmitButton().addEventListener("click",()=>{let d=r.value,E=i.value;E&&e(d,E)});let a=this.containerEl.createEl("div",{cls:"mesh-ai-response"});return{updateResponse:d=>{a.innerHTML=`<pre>${d}</pre>`},showLoading:()=>{a.innerHTML='<div class="mesh-ai-loading">Processing...</div>'},hideLoading:()=>{a.innerHTML=""}}}createProviderSelect(t){let e=this.containerEl.createEl("div",{cls:"mesh-ai-select-container"});e.createEl("label",{text:"Select Provider:",attr:{for:"mesh-ai-provider"}});let n=e.createEl("select",{cls:"mesh-ai-select",attr:{id:"mesh-ai-provider"}});return[{value:"openai",label:"OpenAI"},{value:"google",label:"Google"},{value:"microsoft",label:"Microsoft"},{value:"anthropic",label:"Anthropic"},{value:"grocq",label:"Grocq"},{value:"ollama",label:"Ollama"}].forEach(i=>{let o=n.createEl("option",{value:i.value,text:i.label});this.isProviderConfigured(i.value,t)?o.disabled=!1:o.disabled=!0}),n}isProviderConfigured(t,e){return t==="ollama"?!!e.ollamaServerUrl:!!e[`${t}ApiKey`]}createPromptInput(){let t=this.containerEl.createEl("div",{cls:"mesh-ai-input-container"});return t.createEl("label",{text:"Enter your prompt:",attr:{for:"mesh-ai-prompt"}}),t.createEl("textarea",{cls:"mesh-ai-input",attr:{id:"mesh-ai-prompt",rows:"4"}})}createSubmitButton(){return this.containerEl.createEl("button",{cls:"mesh-ai-submit",text:"Submit"})}};var se=require("obsidian"),be=class extends se.Modal{constructor(e,n,r,i,o){super(e);this.youtubeLinks=r,this.onRun=i,this.onSkip=o,this.youtubeProvider=n.youtubeProvider}onOpen(){let{contentEl:e}=this;e.empty(),e.createEl("h2",{text:"YouTube Links Detected"});let n=e.createEl("select");this.youtubeLinks.forEach(r=>{let i=n.createEl("option",{text:r});i.value=r}),new se.Setting(e).addButton(r=>{r.setButtonText("Run").setCta().onClick(async()=>{let i=n.value;if(i)try{let o=await this.youtubeProvider.getTranscript(i);this.onRun(o),this.close()}catch(o){new se.Notice(`Failed to fetch YouTube transcript: ${o.message}`),this.onSkip(),this.close()}else new se.Notice("Please select a YouTube link")})}).addButton(r=>{r.setButtonText("Skip").onClick(()=>{this.onSkip(),this.close()})})}onClose(){let{contentEl:e}=this;e.empty()}};async function Ue(p,t,e){try{return await p.getProvider(t).generateResponse(e)}catch(n){throw console.error("LLM Request failed:",n),new Error(`LLM Request failed: ${n.message}`)}}var Ke=`
# You will be given prompt instructions that should not be included in your generation, just the content below the divider. The divider is a series of 10 asterisks (*) on a new line.

{patternContents}

You are now tasked with processing the data that follows, applying the guidelines and structure outlined in the previous prompt. Your primary goal is to enhance the rough notes into well-organized, detailed, and contextually rich documentation. Ensure that all data is accurately captured, formatted in markdown, and made easily retrievable for future reference.

Key Instructions:

Maintain Consistency: Keep the formatting consistent throughout the document, adhering to the markdown structure provided.
Contextual Clarity: Add or infer any missing details to enhance the clarity and context of the notes.
Summarization and Structuring: Make the notes concise but informative, ensuring that they are structured in a way that aids retrieval by a RAG system.
Task Identification: Pay special attention to tasks, ensuring they are clearly marked with appropriate statuses (incomplete, completed, in progress) and use the provided icons and formats to enhance readability.
Resource Linking: If any online resources are mentioned or inferred, link them appropriately using official URLs or PDFs.
Define Uncommon Terms: Identify and define any uncommon or significant terms, linking to relevant wiki pages where possible.
Data Availability: If no data follows this prompt, return an error indicating that no data was sent to process.
Proceed to process the data below according to these guidelines.

**********

{input}
`;async function tt(p,t,e,n){let r=/(?:https?:\/\/)?(?:www\.)?(?:youtube\.com|youtu\.be)\/(?:watch\?v=)?(?:embed\/)?(?:v\/)?(?:shorts\/)?(?:\S+)/g,i="";switch(e){case"active-note":case"clipboard":i=e==="active-note"?await et(p):await navigator.clipboard.readText();let o=Array.from(i.match(r)||[]);o&&o.length>0&&(i=await new Promise(a=>{new be(p,t,o,d=>{a(`YouTube Transcript:

${d}

Original Content:

${i}`)},()=>{a(i)}).open()}));break;case"tavily":Y(t,"Searching Tavily for:",n.value),i=await t.tavilyProvider.search(n.value);break}if(!i)throw new Error("No input content available");return i}function Y(p,...t){p.settings.enableDebugging&&console.log(...t)}async function rt(p,t,e,n){let r=n;for(let i of e){let o=await Re(p,i),a=Ke.replace("{patternContents}",o).replace("{input}",r);Y(p,`Applying pattern: ${i}`),Y(p,"Full prompt being sent to LLM:",a),r=await Ue(p,t,a)}return r}async function nt(p,t,e,n){let r="";for(let i of e){let o=await Re(p,i),a=Ke.replace("{patternContents}",o).replace("{input}",n),d=await Ue(p,t,a);r+=`# ${i}

---

${d}


`}return r}var ae="mesh-view",Ee=class extends ie.ItemView{constructor(e,n){super(e);this.selectedPatterns=[];this.handleClickOutside=e=>{(!(e.target instanceof Node)||!this.patternResults.contains(e.target))&&(this.patternResults.style.display="none")};this.plugin=n,this.patternStitchingEnabled=this.plugin.settings.patternStitchingEnabled}getViewType(){return ae}getDisplayText(){return"Mesh AI"}async onOpen(){let e=this.containerEl.children[1];e.empty(),e.addClass("mesh-view-container");let n=e.createEl("div",{cls:"particles-js",attr:{id:"particles-js"}}),r=e.createEl("div",{cls:"mesh-form-container"}),i=this.createCard(r,"provider"),o=ue.createSelect(i,"mesh-provider-select",["openai","google","microsoft","anthropic","grocq","ollama"]),a=this.createCard(r,"input"),d=ue.createSelect(a,"mesh-input-source-select",["active-note","clipboard","tavily"]),E=a.createEl("input",{type:"text",placeholder:"Enter Tavily search query",cls:"mesh-tavily-input"});E.style.display="none",d.addEventListener("change",()=>{E.style.display=d.value==="tavily"?"block":"none"});let I=this.createCard(r,"patterns"),U=I.createEl("div",{cls:"pattern-search-container"});this.patternInput=new ie.TextComponent(U).setPlaceholder("Search patterns...").onChange(Q=>{Ze(this.plugin,Q,this.patternResults,ee=>{Qe(ee,this.selectedPatterns,()=>Be(this.selectedPatternsContainer,this.selectedPatterns,J=>{this.selectedPatterns=J}),()=>this.patternInput.setValue(""),()=>this.patternResults.empty())})}),this.patternResults=U.createEl("div",{cls:"pattern-results"});let _=I.createEl("h4",{text:"Selected Patterns",cls:"mesh-selected-patterns-title"});this.selectedPatternsContainer=I.createEl("div",{cls:"selected-patterns-container"});let O=I.createEl("div",{cls:"pattern-stitching-container"}),V=O.createEl("label",{cls:"switch"}),z=V.createEl("input",{type:"checkbox",cls:"pattern-stitching-input"});z.checked=this.patternStitchingEnabled,V.createEl("span",{cls:"slider round"});let Ge=O.createEl("span",{text:"Pattern Stitching",cls:"pattern-stitching-label"});z.addEventListener("change",Q=>{this.patternStitchingEnabled=Q.target.checked,this.plugin.settings.patternStitchingEnabled=this.patternStitchingEnabled,this.plugin.saveSettings();let ee=this.patternStitchingEnabled?"enabled":"disabled";new ie.Notice(`Pattern Stitching ${ee}.`)});let ce=this.createCard(r,"output");this.outputFileNameInput=ce.createEl("input",{type:"text",placeholder:"Output file name (optional)",cls:"mesh-output-filename-input"}),r.createEl("div",{cls:"mesh-submit-button-container"}).createEl("button",{text:"Submit",cls:"mesh-submit-button"}).addEventListener("click",this.onSubmit.bind(this)),this.loadingElement=e.createEl("div",{text:"Processing...",cls:"mesh-loading"}),this.loadingElement.hide(),this.initParticles(),document.addEventListener("click",this.handleClickOutside)}initParticles(){let e=this.containerEl.children[1],n=e.createEl("div",{cls:"particles-js",attr:{id:"particles-js"}});if(window.particlesJS){let r=()=>{window.particlesJS("particles-js",{particles:{number:{value:80,density:{enable:!0,value_area:800}},color:{value:["#81a0ed","#694daa"]},shape:{type:"circle"},opacity:{value:.5,random:!1},size:{value:3,random:!0},line_linked:{enable:!0,distance:150,color:"#81a0ed",opacity:.4,width:1},move:{enable:!0,speed:2,direction:"none",random:!1,straight:!1,out_mode:"out",bounce:!1}},interactivity:{detect_on:"canvas",events:{onhover:{enable:!0,mode:"repulse"},onclick:{enable:!0,mode:"push"},resize:!0},modes:{grab:{distance:400,line_linked:{opacity:1}},bubble:{distance:400,size:40,duration:2,opacity:8,speed:3},repulse:{distance:200,duration:.4},push:{particles_nb:4},remove:{particles_nb:2}}},retina_detect:!0})};r();let i=this.debounce(()=>{window.pJSDom&&window.pJSDom[0]&&window.pJSDom[0].pJS&&window.pJSDom[0].pJS.fn.vendors.destroypJS(),r()},250);window.addEventListener("resize",i),new ResizeObserver(()=>{let a=n.querySelector("canvas");a&&(a.width=n.clientWidth,a.height=n.clientHeight)}).observe(e)}}debounce(e,n){let r;return(...i)=>{clearTimeout(r),r=setTimeout(()=>e.apply(this,i),n)}}createCard(e,n){let r=e.createEl("div",{cls:`mesh-card ${n.toLowerCase()}`});return r.createEl("h3",{text:n,cls:"mesh-card-title"}),r}updateTheme(){let e=document.body.classList.contains("theme-dark");this.containerEl.toggleClass("theme-dark",e),this.containerEl.toggleClass("theme-light",!e)}async onSubmit(){Y(this.plugin,"onSubmit method called");let e=this.containerEl.querySelector(".mesh-provider-select"),n=this.containerEl.querySelector(".mesh-input-source-select"),r=this.containerEl.querySelector(".mesh-tavily-input");Y(this.plugin,"Selected provider:",e.value),Y(this.plugin,"Selected input source:",n.value),Y(this.plugin,"Tavily search input:",r.value);let i=e.value,o=n.value,a=this.selectedPatterns;try{Y(this.plugin,"Getting input content...");let d=await tt(this.app,this.plugin,o,r);if(this.showLoading(),Y(this.plugin,"Processing patterns..."),this.patternStitchingEnabled){let E=await nt(this.plugin,i,a,d);Y(this.plugin,"Creating output file..."),await De(this.plugin,E,this.outputFileNameInput);return}else{let E=await rt(this.plugin,i,a,d);Y(this.plugin,"Creating output file..."),await De(this.plugin,E,this.outputFileNameInput)}}catch(d){console.error("Error processing request:",d),new ie.Notice(`Error: ${d.message}`)}finally{this.hideLoading()}}async showLoading(){let e=this.containerEl.querySelector(".mesh-form-container"),n=Array.from(e.querySelectorAll(".mesh-card")),r=this.containerEl.querySelector(".mesh-submit-button-container"),i=r.querySelector(".mesh-submit-button");for(let o=0;o<n.length;o++){let a=n[o];a.classList.add("rotating"),await new Promise(d=>setTimeout(d,500)),a.addEventListener("animationend",()=>{a.classList.remove("rotating")},{once:!0})}r.classList.add("processing"),i.classList.add("processing"),i.disabled=!0}hideLoading(){let n=this.containerEl.querySelector(".mesh-form-container").querySelectorAll(".mesh-card"),r=this.containerEl.querySelector(".mesh-submit-button-container"),i=r.querySelector(".mesh-submit-button");n.forEach(o=>{o.classList.remove("rotating")}),r.classList.remove("processing"),i.classList.remove("processing"),i.disabled=!1}};var $=require("obsidian"),Ae=class extends $.PluginSettingTab{constructor(e,n){super(e,n);this.plugin=n}async display(){let{containerEl:e}=this;e.empty();let n=["openai","google","microsoft","anthropic","grocq","ollama"];for(let r of n)if(r==="ollama"?new $.Setting(e).setName("Ollama server URL").setDesc("Enter the URL for your Ollama server").addText(o=>o.setPlaceholder("Enter URL").setValue(this.plugin.settings.ollamaServerUrl).onChange(async a=>{this.plugin.settings.ollamaServerUrl=a,await this.plugin.saveSettings()})):new $.Setting(e).setName(`${r.charAt(0).toUpperCase()+r.slice(1)} API key`).setDesc(`Enter your ${r} API key`).addText(o=>o.setPlaceholder("Enter API key").setValue(this.plugin.settings[`${r}ApiKey`]).onChange(async a=>{this.plugin.settings[`${r}ApiKey`]=a,await this.plugin.saveSettings()})),r==="ollama"?this.plugin.settings.ollamaServerUrl:this.plugin.settings[`${r}ApiKey`]){let o=new $.Setting(e).setName(`${r.charAt(0).toUpperCase()+r.slice(1)} model`).setDesc(`Select the model for ${r}`).addDropdown(async a=>{await this.populateModelDropdown(a,r)});o.addButton(a=>{a.setButtonText("Refresh models").onClick(async()=>{let d=o.components[0];await this.populateModelDropdown(d,r,!0)})})}new $.Setting(e).setName("Selected provider").setDesc("Choose the default provider").addDropdown(r=>{n.forEach(i=>{(i==="ollama"?this.plugin.settings.ollamaServerUrl:this.plugin.settings[`${i}ApiKey`])&&r.addOption(i,i)}),r.setValue(this.plugin.settings.selectedProvider).onChange(async i=>{this.plugin.settings.selectedProvider=i,await this.plugin.saveSettings()})}),new $.Setting(e).setName("Tavily API key").setDesc("Enter your Tavily API key").addText(r=>r.setPlaceholder("Enter API key").setValue(this.plugin.settings.tavilyApiKey).onChange(async i=>{this.plugin.settings.tavilyApiKey=i,await this.plugin.saveSettings()})),new $.Setting(e).setName("YouTube API key").setDesc("Enter your YouTube API key for transcript fetching").addText(r=>r.setPlaceholder("Enter API key").setValue(this.plugin.settings.youtubeApiKey).onChange(async i=>{this.plugin.settings.youtubeApiKey=i,await this.plugin.saveSettings()})),new $.Setting(e).setName("Custom patterns folder").setDesc(`Enter the name of the folder containing custom patterns. If it's in the root of your vault, just enter the folder name (e.g., "Custom Patterns").`).addText(r=>r.setPlaceholder("Custom Patterns").setValue(this.plugin.settings.customPatternsFolder).onChange(async i=>{this.plugin.settings.customPatternsFolder=i,await this.plugin.saveSettings()})),new $.Setting(e).setName("Fabric Patterns Folder").setDesc("Folder where downloaded patterns will be saved").addText(r=>r.setPlaceholder("Enter folder path").setValue(this.plugin.settings.fabricPatternsFolder).onChange(async i=>{this.plugin.settings.fabricPatternsFolder=i,await this.plugin.saveSettings()})),new $.Setting(e).setName("Download Patterns").setDesc("Download patterns from GitHub").addButton(r=>r.setButtonText("Download").onClick(async()=>{await this.plugin.downloadPatternsFromGitHub(),this.display()})),new $.Setting(e).setName("Mesh output folder").setDesc("Enter the name of the folder for Mesh AI output. If it's in the root of your vault, just enter the folder name.").addText(r=>r.setPlaceholder("Mesh Output").setValue(this.plugin.settings.meshOutputFolder).onChange(async i=>{this.plugin.settings.meshOutputFolder=i,await this.plugin.saveSettings()})),new $.Setting(e).setName("Enable Debugging").setDesc("Turn on console logging for debugging purposes").addToggle(r=>r.setValue(this.plugin.settings.enableDebugging).onChange(async i=>{this.plugin.settings.enableDebugging=i;let o=this.plugin.settings.enableDebugging?"enabled":"disabled";new $.Notice(`Debugging ${o}.`),await this.plugin.saveSettings()}))}async populateModelDropdown(e,n,r=!1){var i;e.selectEl.disabled=!0;try{let o;if(r?o=await this.getModelsForProvider(n):o=this.plugin.settings.providerModels[n]||await this.getModelsForProvider(n),e.selectEl.innerHTML="",o&&o.length>0){o.forEach(E=>e.addOption(E,E));let a=(i=this.plugin.settings.providerModels[n])==null?void 0:i[0],d=o.includes(a)?a:o[0];e.setValue(d).onChange(async E=>{this.plugin.settings.providerModels[n]=[E],await this.plugin.saveSettings()})}else e.addOption("","No models available"),console.warn(`No models available for ${n}`)}catch(o){console.error(`Error fetching models for ${n}:`,o),e.addOption("error","Error fetching models")}finally{e.selectEl.disabled=!1}}async getModelsForProvider(e){try{let n=this.plugin.getProvider(e);if(n&&"getAvailableModels"in n)return await n.getAvailableModels()}catch(n){console.error(`Error fetching models for ${e}:`,n)}return this.plugin.settings.providerModels[e]||[]}};var st={openaiApiKey:"",googleApiKey:"",microsoftApiKey:"",anthropicApiKey:"",grocqApiKey:"",tavilyApiKey:"",youtubeApiKey:"",ollamaServerUrl:"http://localhost:11434",selectedProvider:"openai",selectedModel:"",providerModels:{openai:[],google:[],microsoft:[],anthropic:[],grocq:[],ollama:[]},customPatternsFolder:"",fabricPatternsFolder:"",meshOutputFolder:"",patternStitchingEnabled:!1,enableDebugging:!1};var le=class{constructor(t,e={}){this.baseUrl=t,this.headers=e}async fetchWithErrorHandling(t,e){let n=await fetch(t,e);if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);return n}};var D=class extends le{async get(t){let e=await fetch(`${this.baseUrl}${t}`,{method:"GET",headers:this.headers});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}async post(t,e,n=!1){let r=await fetch(`${this.baseUrl}${t}`,{method:"POST",headers:this.headers,body:JSON.stringify(e)});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);return n?r:await r.json()}async postStream(t,e,n){var a;let i=(a=(await this.fetchWithErrorHandling(`${this.baseUrl}${t}`,{method:"POST",headers:{"Content-Type":"application/json",...this.headers},body:JSON.stringify(e)})).body)==null?void 0:a.getReader(),o=new TextDecoder;if(i)try{for(;;){let{done:d,value:E}=await i.read();if(d)break;let U=o.decode(E,{stream:!0}).split(`
`).filter(_=>_.trim()!=="");for(let _ of U)if(_.startsWith("data: ")){let O=_.slice(6);if(O==="[DONE]")break;try{let V=JSON.parse(O);n(V)}catch(V){console.error("Error parsing JSON:",V)}}}}finally{i.releaseLock()}}};var Se=class{constructor(t,e){this.apiHelper=new D("https://api.openai.com/v1",{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}),this.plugin=e}async generateResponse(t,e){let n=this.plugin.settings.providerModels.openai,r=n&&n.length>0?n[0]:"gpt-3.5-turbo";if(console.log("Using OpenAI model:",r),!r)throw new Error("No OpenAI model has been selected. Please choose a model in the settings.");let i="/chat/completions",o={model:r,messages:[{role:"system",content:"You are a helpful assistant."},{role:"user",content:t}],stream:!!e};try{if(e){let a="";return await this.apiHelper.postStream(i,o,d=>{if(d.choices&&d.choices[0].delta&&d.choices[0].delta.content){let E=d.choices[0].delta.content;a+=E,e(E)}}),a.trim()}else{let a=await this.apiHelper.post(i,o);if(a.choices&&a.choices[0]&&a.choices[0].message)return a.choices[0].message.content.trim();throw new Error("Unexpected response format from OpenAI API")}}catch(a){throw console.error(`Error generating response with model ${r}:`,a),a.response&&(console.error("Response status:",a.response.status),console.error("Response data:",a.response.data)),new Error(`Failed to generate response: ${a.message}`)}}async getAvailableModels(){try{let t=await this.apiHelper.get("/models");if(t.data&&Array.isArray(t.data))return t.data.filter(e=>e.id.startsWith("gpt-")).map(e=>e.id);throw new Error("Unexpected response format from OpenAI API")}catch(t){throw console.error("Error fetching OpenAI models:",t),t}}};var it=require("obsidian"),xe=class{constructor(t,e){this.apiHelper=new D("https://generativelanguage.googleapis.com/v1beta",{"x-goog-api-key":t}),this.plugin=e}async getAvailableModels(){try{let t=await this.apiHelper.post("/models",{});if(t.models&&Array.isArray(t.models))return t.models.filter(e=>e.supportedGenerationMethods.includes("generateContent")).map(e=>e.name);throw new Error("Unexpected response format from Google API")}catch(t){throw console.error("Error fetching Google models:",t),t}}async generateResponse(t,e){let n=this.plugin.settings.providerModels.google,r=n&&n.length>0?n[0]:"chat-bison-001";r||new it.Notice('No Google model has been selected. Using default model "chat-bison-001".');let i="";try{return await this.apiHelper.postStream(`/models/${r}:streamGenerateContent`,{contents:[{parts:[{text:t}]}],safety_settings:[{category:"HARM_CATEGORY_DANGEROUS",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_HARASSMENT",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_HATE_SPEECH",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_SEXUALLY_EXPLICIT",threshold:"BLOCK_NONE"},{category:"HARM_CATEGORY_DANGEROUS_CONTENT",threshold:"BLOCK_NONE"}]},o=>{if(o.candidates&&o.candidates[0].content&&o.candidates[0].content.parts){let a=o.candidates[0].content.parts[0].text;i+=a,e&&e(a)}}),i}catch(o){throw console.error(`Error generating response with model ${r}:`,o),new Error(`Failed to generate response: ${o.message}`)}}};var ot=require("obsidian"),Te=class{constructor(t,e){this.apiHelper=new D("https://api.cognitive.microsoft.com",{"api-key":t}),this.plugin=e}async getAvailableModels(){try{let t=await this.apiHelper.post("/openai/deployments?api-version=2023-05-15",{});if(t.value&&Array.isArray(t.value))return t.value.filter(e=>e.model.startsWith("gpt")).map(e=>e.id);throw new Error("Unexpected response format from Microsoft API")}catch(t){throw console.error("Error fetching Microsoft models:",t),t}}async generateResponse(t,e){let n=this.plugin.settings.providerModels.microsoft,r=n&&n.length>0?n[0]:"gpt-35-turbo";r||new ot.Notice('No Microsoft model has been selected. Using default model "gpt-35-turbo".');let i="";try{return await this.apiHelper.postStream(`/openai/deployments/${r}/chat/completions?api-version=2023-05-15`,{messages:[{role:"user",content:t}],stream:!0},o=>{if(o.choices&&o.choices[0].delta&&o.choices[0].delta.content){let a=o.choices[0].delta.content;i+=a,e&&e(a)}}),i}catch(o){throw console.error(`Error generating response with model ${r}:`,o),new Error(`Failed to generate response: ${o.message}`)}}};var at=require("obsidian"),Me=class{constructor(t,e){this.apiHelper=new D("https://api.anthropic.com/v1",{"x-api-key":t,"anthropic-version":"2023-06-01"}),this.plugin=e}async getAvailableModels(){try{let t=await this.apiHelper.post("/models",{});if(t.models&&Array.isArray(t.models))return t.models.filter(e=>e.type==="chat").map(e=>e.id);throw new Error("Unexpected response format from Anthropic API")}catch(t){throw console.error("Error fetching Anthropic models:",t),t}}async generateResponse(t,e){let n=this.plugin.settings.providerModels.anthropic,r=n&&n.length>0?n[0]:"claude-2";r||new at.Notice('No Anthropic model has been selected. Using default model "claude-2".');let i="";try{return await this.apiHelper.postStream("/messages",{model:r,messages:[{role:"user",content:t}],max_tokens:1e3,stream:!0},o=>{var a;if(o.type==="content_block_delta"&&((a=o.delta)!=null&&a.text)){let d=o.delta.text;i+=d,e&&e(d)}}),i}catch(o){throw console.error(`Error generating response with model ${r}:`,o),new Error(`Failed to generate response: ${o.message}`)}}};var lt=require("obsidian"),Ie=class{constructor(t,e){this.apiHelper=new D("https://api.groq.com/openai/v1",{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}),this.plugin=e}async getAvailableModels(){try{let t=await this.apiHelper.get("/models");if(t.data&&Array.isArray(t.data))return t.data.map(e=>e.id);throw new Error("Unexpected response format from Groq API")}catch(t){throw console.error("Error fetching Groq models:",t),t}}async generateResponse(t,e){let n=this.plugin.settings.providerModels.grocq,r=n&&n.length>0?n[0]:"mixtral-8x7b-32768";r||new lt.Notice('No Groq model has been selected. Using default model "mixtral-8x7b-32768".');try{let i=await this.apiHelper.post("/chat/completions",{model:r,messages:[{role:"user",content:t}]});if(i.choices&&i.choices.length>0){let o=i.choices[0].message.content;return e&&e(o),o}else throw new Error("No response content received from Groq API")}catch(i){throw console.error(`Error generating response with model ${r}:`,i),new Error(`Failed to generate response: ${i.message}`)}}};var ct=require("obsidian");var _e=class extends le{async get(t){let e=await fetch(`${this.baseUrl}${t}`,{method:"GET"});if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return e.json()}async post(t,e){return await(await this.fetchWithErrorHandling(`${this.baseUrl}${t}`,{method:"POST",headers:{"Content-Type":"application/json",...this.headers},body:JSON.stringify(e)})).json()}async postStream(t,e,n){var a;let i=(a=(await this.fetchWithErrorHandling(`${this.baseUrl}${t}`,{method:"POST",headers:{"Content-Type":"application/json",...this.headers},body:JSON.stringify(e)})).body)==null?void 0:a.getReader(),o=new TextDecoder;if(i)try{let d="";for(;;){let{done:E,value:I}=await i.read();if(E)break;d+=o.decode(I,{stream:!0});let U;for(;(U=d.indexOf(`
`))!==-1;){let _=d.slice(0,U);if(d=d.slice(U+1),_.trim())try{let O=JSON.parse(_);n(O)}catch(O){console.error("Error parsing JSON:",O)}}}}finally{i.releaseLock()}}};var Le=class{constructor(t,e){this.apiHelper=new _e(t),this.plugin=e}async getAvailableModels(){try{let t=await this.apiHelper.get("/api/tags");if(t.models&&Array.isArray(t.models))return t.models.map(e=>e.name);throw new Error("Unexpected response format from Ollama API")}catch(t){throw console.error("Error fetching Ollama models:",t),new Error("Failed to fetch Ollama models. Please ensure the Ollama server is running and the URL is correct.")}}async generateResponse(t,e){let n=this.plugin.settings.providerModels.ollama,r=n&&n.length>0?n[0]:"llama2";r||new ct.Notice('No Ollama model has been selected. Using default model "llama2".');let i="";try{return await this.apiHelper.postStream("/api/generate",{model:r,prompt:t,stream:!0},o=>{o.response&&(i+=o.response,e&&e(o.response))}),i}catch(o){throw console.error(`Error generating response with model ${r}:`,o),new Error(`Failed to generate response: ${o.message}`)}}};var qe=require("obsidian"),Ce=class{constructor(t){console.log("Initializing YoutubeProvider"),this.plugin=t}async getTranscript(t){console.log(`[getTranscript] Attempting to fetch transcript for URL: ${t}`);try{let e=this.extractVideoId(t);if(!e)throw new Error("Invalid YouTube URL, cannot extract video ID");let n=await this.grabTranscriptBase(e);if(!n)throw new Error("No transcript found for this video");let o=new DOMParser().parseFromString(n,"text/xml").getElementsByTagName("text"),a="";for(let d=0;d<o.length;d++)a+=o[d].textContent+" ";return console.log(`[getTranscript] Transcript fetched successfully. Length: ${a.length}`),a.trim()}catch(e){throw console.error("[getTranscript] Error fetching YouTube transcript:",e),e}}async grabTranscriptBase(t){let e=`https://www.youtube.com/watch?v=${t}`,r=(await(0,qe.requestUrl)({url:e})).text,i=/"captionTracks":(\[.*?\])/,o=r.match(i);if(o&&o[1]){let a=JSON.parse(o[1]);if(a.length>0){let d=a[0].baseUrl;return(await(0,qe.requestUrl)({url:d})).text}}return null}extractVideoId(t){let e=/(?:https?:\/\/)?(?:www\.)?(?:youtube\.com\/(?:[^\/\n\s]+\/\S+\/|(?:v|e(?:mbed)?)\/|\S*?[?&]v=)|youtu\.be\/)([a-zA-Z0-9_-]{11})/,n=t.match(e);return n?n[1]:null}};var Fe=class{constructor(t,e){this.apiHelper=new D("https://api.tavily.com",{"Content-Type":"application/json"}),this.plugin=e,this.apiKey=t}async search(t){try{let e=await this.apiHelper.post("/search",{api_key:this.apiKey,query:t,search_depth:"advanced",include_answer:!0,include_images:!0,include_raw_content:!1,max_results:10});if(e)return JSON.stringify(e);throw new Error("No results found in Tavily response")}catch(e){throw console.error("Error fetching results from Tavily:",e),e.response&&(console.error("Response status:",e.response.status),console.error("Response data:",e.response.data)),new Error(`Failed to fetch results from Tavily: ${e.message}`)}}};var He=class extends F.Plugin{async onload(){await this.loadSettings(),await this.loadParticlesJS(),this.youtubeProvider=new Ce(this),this.tavilyProvider=new Fe(this.settings.tavilyApiKey,this),this.addSettingTab(new Ae(this.app,this)),this.registerView(ae,e=>new Ee(e,this)),this.addRibbonIcon("brain","Mesh AI Integration",()=>{this.activateView()})}async loadParticlesJS(){return new Promise(e=>{let n=document.createElement("script");n.src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js",n.onload=()=>e(),document.head.appendChild(n)})}async loadSettings(){this.settings=Object.assign({},st,await this.loadData())}async saveSettings(){await this.saveData(this.settings)}async activateView(){let{workspace:e}=this.app;e.detachLeavesOfType(ae);let n=e.getLeavesOfType(ae)[0];if(!n){let r=e.getRightLeaf(!1);if(r)await r.setViewState({type:ae,active:!0}),n=r;else{console.error("Failed to create a new leaf for Mesh AI view");return}}e.revealLeaf(n)}async loadAllPatterns(){let e=await this.loadCustomPatterns(),n=await this.loadFabricPatterns();return[...new Set([...e,...n])].sort()}async loadCustomPatterns(){let e=this.app.vault.getAbstractFileByPath(this.settings.customPatternsFolder),n=[];if(e instanceof F.TFolder)for(let r of e.children)r instanceof F.TFile&&r.extension==="md"&&n.push(r.basename);return n.sort()}async loadFabricPatterns(){let e=this.app.vault.getAbstractFileByPath(this.settings.fabricPatternsFolder),n=[];if(e instanceof F.TFolder)for(let r of e.children)r instanceof F.TFile&&r.extension==="md"&&n.push(r.basename);return n.sort()}async downloadPatternsFromGitHub(){let e="https://api.github.com/repos/danielmiessler/fabric/contents/patterns",n="https://raw.githubusercontent.com/danielmiessler/fabric/main/patterns";try{this.app.vault.getAbstractFileByPath(this.settings.fabricPatternsFolder)instanceof F.TFolder||await this.app.vault.createFolder(this.settings.fabricPatternsFolder);let o=(await(0,F.requestUrl)({url:e})).json.filter(E=>E.type==="dir"),a=0,d=0;for(let E of o)try{let I=`${E.name}.md`,U=`${n}/${E.name}/system.md`,_=`${this.settings.fabricPatternsFolder}/${I}`,O=await(0,F.requestUrl)({url:U}),V=this.app.vault.getAbstractFileByPath(_);V instanceof F.TFile?(await this.app.vault.modify(V,O.text),console.log(`Updated existing file: ${I}`)):(await this.app.vault.create(_,O.text),console.log(`Created new file: ${I}`)),a++}catch(I){console.error(`Error processing ${E.name}:`,I),I instanceof Error&&(console.error(`Error message: ${I.message}`),console.error(`Error stack: ${I.stack}`)),d++}new F.Notice(`Successfully downloaded/updated ${a} patterns. ${d} failed.`),await this.loadAllPatterns()}catch(r){console.error("Error in downloadPatternsFromGitHub:",r),new F.Notice(`Failed to download patterns: ${r.message}`)}}async clearFabricPatternsFolder(){let e=this.app.vault.getAbstractFileByPath(this.settings.fabricPatternsFolder);if(e instanceof F.TFolder)for(let n of e.children)n instanceof F.TFile&&await this.app.vault.delete(n);else await this.app.vault.createFolder(this.settings.fabricPatternsFolder)}getProvider(e){switch(e){case"openai":return new Se(this.settings.openaiApiKey,this);case"google":return new xe(this.settings.googleApiKey,this);case"microsoft":return new Te(this.settings.microsoftApiKey,this);case"anthropic":return new Me(this.settings.anthropicApiKey,this);case"grocq":return new Ie(this.settings.grocqApiKey,this);case"ollama":return new Le(this.settings.ollamaServerUrl,this);default:throw new Error(`Unknown provider: ${e}`)}}};
